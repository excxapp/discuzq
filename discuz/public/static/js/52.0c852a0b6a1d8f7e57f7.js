(window.webpackJsonp=window.webpackJsonp||[]).push([[52,116],{"+1ub":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.autoTextarea=function(t,e,i,a){e=e||0;var o=!!document.getBoxObjectFor||"mozInnerScreenX"in window,s=!!window.opera&&!!window.opera.toString().indexOf("Opera"),n=function(e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent("on"+e,i)},r=t.currentStyle?function(e){var i=t.currentStyle[e];if("height"===e&&1!==i.search(/px/i)){var a=t.getBoundingClientRect();return a.bottom-a.top-parseFloat(r("paddingTop"))-parseFloat(r("paddingBottom"))+"px"}return i}:function(e){return getComputedStyle(t,null)[e]},c=parseFloat(r("height"));t.style.resize="none";var l=function(){var n,l,d=0,u=t.style;t._length!==t.value.length&&(t._length=t.value.length,o||s||(d=parseInt(r("paddingTop"))+parseInt(r("paddingBottom"))),n=document.body.scrollTop||document.documentElement.scrollTop,t.style.height=c+"px",t.scrollHeight>c&&(i&&t.scrollHeight>i?(l=i-d,u.overflowY="hidden"):(l=t.scrollHeight-d,u.overflowY="hidden"),u.height=l+e+"px",n+=parseInt(u.height)-t.currHeight,document.body.scrollTop=n,document.documentElement.scrollTop=n,t.currHeight=parseInt(u.height),a(parseInt(u.height))))};n("propertychange",l),n("input",l),n("focus",l),l()},e.debounce=function(t,e){var i=void 0;return function(){for(var a=this,o=arguments.length,s=Array(o),n=0;n<o;n++)s[n]=arguments[n];i&&clearTimeout(i),i=setTimeout((function(){t.apply(a,s)}),e||500)}}},"1MZ2":function(t,e,i){"use strict";i.r(e);var a=i("8Wlw"),o=i.n(a);for(var s in a)"default"!==s&&function(t){i.d(e,t,(function(){return a[t]}))}(s);e.default=o.a},"6GI9":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={data:function(){return{active:0,faceIndex:0}},props:{faceData:{type:Array}},computed:{faces:function(){for(var t=this.faceData,e=(this.faceIndex,t),i=0,a=[];28*i<e.length;)a.push(e.slice(28*i,28*(i+1))),i+=1;return a},scrollWidth:function(){return this.faces.length*document.body.clientWidth},scrollPosition:function(){return this.active*document.body.clientWidth}},mounted:function(){var t=this,e=this.$refs.faceContent,i=0,a=0;e.ontouchstart=function(t){i=t.targetTouches[0].pageX},e.ontouchend=function(e){(a=e.changedTouches[0].pageX)-i>50?0!==t.active&&t.active--:a-i<-50&&t.active!==t.faces.length-1&&t.active++}},created:function(){},methods:{getUrlCode:function(){var t=this;this.code=this.$utils.getUrlKey("code"),alert(code),this.appFetch({url:"weixin",method:"get",data:{code:this.code}}).then((function(t){alert(65756765)}),(function(e){100004==e.errors[0].status&&t.$router.go(-1)}))},loginWxClick:function(){this.$router.push({path:"/wx-login-bd"})},loginPhoneClick:function(){this.$router.push({path:"/login-phone"})},onFaceClick:function(t){this.$emit("onFaceChoose",t)}}}},"8Wlw":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n(i("QbLZ")),o=n(i("eERW")),s=n(i("SDcr"));function n(t){return t&&t.__esModule?t:{default:t}}i("iUmJ"),i("N960"),e.default=(0,a.default)({name:"post-video",components:{Expression:s.default}},o.default)},Aves:function(t,e,i){"use strict";i.d(e,"a",(function(){return a})),i.d(e,"b",(function(){return o}));var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"face-container"},[i("div",{staticClass:"scroll-wrapper"},[i("div",{ref:"faceContent",staticClass:"face-content",style:{width:t.scrollWidth+"px",marginLeft:-t.scrollPosition+"px"},on:{touchmove:function(t){t.preventDefault()}}},t._l(t.faces,(function(e,a){return i("div",{key:a,staticClass:"face-page"},t._l(e,(function(e,a){return i("a",{key:a},[i("img",{staticClass:"emoji",attrs:{src:e._data.url},on:{click:function(i){return t.onFaceClick(" "+e._data.code+" ")}}})])})),0)})),0),t._v(" "),i("div",{staticClass:"page-dot"},t._l(t.faces.length,(function(e){return i("div",{key:e,staticClass:"dot-item",class:e===t.active+1?"active":"",on:{click:function(i){t.active=e-1}}})})),0)])])},o=[]},E7ft:function(t,e,i){"use strict";i.r(e);var a=i("TZST"),o=i("1MZ2");for(var s in o)"default"!==s&&function(t){i.d(e,t,(function(){return o[t]}))}(s);var n=i("KHd+"),r=Object(n.a)(o.default,a.a,a.b,!1,null,null,null);e.default=r.exports},SDcr:function(t,e,i){"use strict";i.r(e);var a=i("Aves"),o=i("uwTP");for(var s in o)"default"!==s&&function(t){i.d(e,t,(function(){return o[t]}))}(s);var n=i("KHd+"),r=Object(n.a)(o.default,a.a,a.b,!1,null,null,null);e.default=r.exports},TZST:function(t,e,i){"use strict";i.d(e,"a",(function(){return a})),i.d(e,"b",(function(){return o}));var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"post-topic-box"},[i("header",{staticClass:"post-topic-header",style:{overflow:"hidden",width:t.isPhone||t.isWeixin?"100%":"640px",left:t.isPhone||t.isWeixin?"0":(t.viewportWidth-640)/2+"px"}},[i("span",{staticClass:"icon iconfont icon-back post-topic-header-icon",on:{click:t.backClick}}),t._v(" "),i("h2",{staticClass:"postHeadTit"},[t._v(t._s(t.headerTitle))]),t._v(" "),i("van-button",{attrs:{type:"primary",size:"mini"},on:{click:t.publish}},[t._v("发布")])],1),t._v(" "),i("div",{staticClass:"post-topic-form",attrs:{id:"postForm"}},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],ref:"textarea",staticClass:"reply-box",attrs:{id:"post-topic-form-text",name:"post-topic",autofocus:"",placeholder:"请输入内容",maxlength:t.keywordsMax},domProps:{value:t.content},on:{focus:function(e){t.showFacePanel=!1,t.footMove=!1,t.keyboard=!1},input:function(e){e.target.composing||(t.content=e.target.value)}}}),t._v(" "),i("form",{ref:"vExample"},[i("input",{ref:"vExampleFile",staticStyle:{display:"none"},attrs:{type:"file",accept:t.supportVideoExtRes,multiple:""},on:{change:t.vExampleUpload}})]),t._v(" "),t.videoUp?i("div",{staticClass:"vedioUpBox"},[i("div",{staticClass:"videoUploader",on:{click:t.vExampleAdd}},[i("span",{staticClass:"icon iconfont icon-add"})])]):t._e(),t._v(" "),t.videoShow?i("div",{staticClass:"videoCon"},[i("div",{staticClass:"videoChi"},[i("span",{staticClass:"icon iconfont icon-video1"}),t._v(" "),i("span",{staticClass:"videoName"},[t._v(t._s(t.vcVideoName))]),t._v(" "),i("van-icon",{staticClass:"videoDelete",attrs:{name:"clear"},on:{click:function(e){return t.videoDeleClick()}}})],1)]):t._e()]),t._v(" "),i("van-cell",{staticClass:"paySetting borderT",class:{payMove:t.payMove},style:{overflow:"hidden",width:t.isPhone||t.isWeixin?"100%":"640px",left:t.isPhone||t.isWeixin?"0":(t.viewportWidth-640)/2+"px"},attrs:{title:"付费设置","is-link":"",value:t.payValue},on:{click:t.paySetting}}),t._v(" "),i("footer",{staticClass:"post-topic-footer",class:{footMove:t.footMove},style:{overflow:"hidden",width:t.isPhone||t.isWeixin?"100%":"640px",left:t.isPhone||t.isWeixin?"0":(t.viewportWidth-640)/2+"px"},attrs:{id:"post-topic-footer"}},[i("div",{staticClass:"post-topic-footer-left",class:{width20:t.encuploadShow}},[i("span",{staticClass:"icon iconfont icon-label post-topic-header-icon",class:{"icon-keyboard":t.keyboard},on:{click:t.addExpression}})]),t._v(" "),i("div",{staticClass:"post-topic-footer-right",on:{click:t.dClick}},[i("span",{staticClass:"post-topic-footer-right-sort"},[t._v(t._s(t.selectSort))]),t._v(" "),i("span",{staticClass:"icon iconfont icon-down-menu post-topic-header-icon",staticStyle:{color:"#888888"}})])]),t._v(" "),i("van-popup",{staticClass:"paySetShow",attrs:{"click-overlay":"closePaySet"},model:{value:t.paySetShow,callback:function(e){t.paySetShow=e},expression:"paySetShow"}},[i("div",{staticClass:"popTitBox"},[i("span",{staticClass:"popupTit"},[t._v("设置金额")]),t._v(" "),i("span",{staticClass:"icon iconfont icon-closeCho",on:{click:t.closePaySet}})]),t._v(" "),i("div",{staticClass:"payMoneyBox"},[i("van-field",{attrs:{type:"number",maxlength:"10",clearable:"",label:"￥",formatter:t.formatter},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search(e)},input:function(e){return t.search(e)}},model:{value:t.paySetValue,callback:function(e){t.paySetValue=e},expression:"paySetValue"}})],1),t._v(" "),i("a",{staticClass:"popSureBtn",class:{sureBtnCli:t.isCli,forbiddenCli:!t.isCli},attrs:{href:"javascript:;"},on:{click:function(e){t.isCli&&t.paySetSure()}}},[t._v("确定")])]),t._v(" "),t.showFacePanel?i("Expression",{staticClass:"expressionBox",style:{overflow:"hidden",width:t.isPhone||t.isWeixin?"100%":"640px",left:t.isPhone||t.isWeixin?"0":(t.viewportWidth-640)/2+"px"},attrs:{faceData:t.faceData},on:{onFaceChoose:t.handleFaceChoose}}):t._e(),t._v(" "),i("div",{staticClass:"popup"},[i("van-popup",{style:{height:"50%"},attrs:{position:"bottom",round:""},model:{value:t.showPopup,callback:function(e){t.showPopup=e},expression:"showPopup"}},[i("van-picker",{attrs:{columns:t.categories,"show-toolbar":"",title:"选择分类"},on:{cancel:t.onCancel,confirm:t.onConfirm}})],1)],1),t._v(" "),t.loading?i("div",{staticClass:"loadFix"},[i("div",{staticClass:"loadMask"}),t._v(" "),i("van-loading",{staticClass:"loadIcon",attrs:{color:"#333333",type:"spinner"}})],1):t._e()],1)},o=[]},eERW:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=l(i("YEIV")),o=i("+1ub"),s=l(i("6NK7")),n=l(i("VVfg")),r=l(i("YSgG")),c=l(i("Bhkv"));function l(t){return t&&t.__esModule?t:{default:t}}var d=parseFloat(document.documentElement.style.fontSize);function u(){return(0,r.default)({url:"signature",method:"get"}).then((function(t){return t.readdata._data.signature}))}e.default={data:function(){var t;return t={headerTitle:"编辑主题",selectSort:"",showPopup:!1,categories:[],categoriesId:[],oldCateId:"",cateId:"",content:"",showFacePanel:!1,keyboard:!1,keywordsMax:1e3,list:[],footMove:!1,payMove:!1,faceData:[],uploadShow:!1,avatar:"",postsId:"",files:{name:"",type:""},headerImage:null,picValue:null,upImgUrl:"",enclosureShow:!1,isWeixin:!1,isPhone:!1,themeCon:!1,attriAttachment:!1,fileLength:0,canUploadImages:"",canUploadAttachments:"",supportImgExt:"",supportImgExtRes:"",supportFileExt:"",supportFileArr:"",limitMaxLength:!0,limitMaxEncLength:!0,isiOS:!1,testingRes:!1,backGo:-2,formdataList:[],viewportHeight:"",postFormScrollTop:"",nowCate:[],payValue:"免费",paySetShow:!1,isCli:!0,moneyVal:"",paySetValue:"",videoShow:!1,videoUp:!1,vcVideoName:"",uploaderInfos:[],testingSizeRes:!1,testingTypeRes:!1,fileId:"",supportVideoExt:"",supportVideoExtRes:"",fileSize:""},(0,a.default)(t,"vcVideoName",""),(0,a.default)(t,"loading",!1),t},mounted:function(){var t=this;document.getElementById("postForm").style.height=this.viewportHeight+"px",document.getElementById("post-topic-form-text").addEventListener("touchstart",(function(e){var i=t.$refs.textarea;i.focus();var a=300;i&&(0,o.autoTextarea)(i,5,65535,(function(t){if((t+=20)!==a){a=t}}))})),this.$nextTick((function(){var e=t.$refs.textarea;e.focus();var i=300;e&&(0,o.autoTextarea)(e,5,65535,(function(t){if((t+=20)!==i){i=t}}))})),1!=this.isWeixin&&1!=this.isPhone&&this.limitWidth()},computed:{themeId:function(){return this.$route.params.themeId}},created:function(){this.tcVod=new c.default({getSignature:u});var t="";if(n.default.getLItem("siteInfo")){this.fileSize=n.default.getLItem("siteInfo")._data.qcloud.qcloud_vod_size,t=n.default.getLItem("siteInfo")._data.qcloud.qcloud_vod_ext.split(",");for(var e="",i="",a=0;a<t.length;a++)e="."+t[a]+",",i="video/"+t[a]+",",this.supportVideoExt+=e,this.supportVideoExtRes+=i}else t="*";this.viewportHeight=window.innerHeight,this.isWeixin=s.default.isWeixin().isWeixin,this.isPhone=s.default.isWeixin().isPhone;var o=navigator.userAgent;this.isAndroid=o.indexOf("Android")>-1||o.indexOf("Adr")>-1,this.isiOS=!!o.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),this.isiOS&&(this.encuploadShow=!0),this.loadCategories(),this.detailsLoad(),this.getInfo()},watch:{showFacePanel:function(t,e){this.showFacePanel=t,this.showFacePanel?document.getElementById("postForm").style.height=this.viewportHeight-240+"px":document.getElementById("postForm").style.height="100%"}},methods:{formatter:function(t){return this.handleReg(t)},handleReg:function(t){return 0==(t=t.toString()).indexOf(".")&&(t="0."),(t=(t=(t=(t=t.replace(/[^\d.]/g,"")).replace(/\.{2,}/g,".")).replace(".","$#$").replace(/\./g,"").replace("$#$",".")).replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3")).indexOf(".")<0&&""!=t&&(t=parseFloat(t)),t},vExampleAdd:function(){this.$refs.vExampleFile.click()},testingType:function(t,e){var i=t.name.substring(t.name.lastIndexOf(".")).toLowerCase();"-1"==e.indexOf(i+",")?(this.$toast.fail("文件格式不正确!"),this.testingTypeRes=!1):this.testingTypeRes=!0},testingSize:function(t,e){t.size/1024/1024>e?(this.$toast.fail("超出视频大小限制"),this.$refs.vExample.reset(),this.testingSizeRes=!1):this.testingSizeRes=!0},vExampleUpload:function(t){var e=this;if(this.testingType(t.target.files[0],this.supportVideoExt),this.testingSize(t.target.files[0],this.fileSize),this.testingSizeRes&&this.testingTypeRes){this.loading=!0;var i=this,a=this.$refs.vExampleFile.files[0];this.vcVideoName=this.$refs.vExampleFile.files[0].name;var o=this.tcVod.upload({mediaFile:a});o.on("media_progress",(function(t){s.progress=t.percent})),o.on("media_upload",(function(t){s.isVideoUploadSuccess=!0}));var s={videoInfo:o.videoInfo,isVideoUploadSuccess:!1,isVideoUploadCancel:!1,progress:0,fileId:"",videoUrl:"",cancel:function(){s.isVideoUploadCancel=!0,o.cancel()}};this.uploaderInfos.push(s),o.done().then((function(t){s.fileId=t.fileId,e.videoUp=!1,e.loading=!1,e.videoShow=!0,e.fileId=t.fileId})).then((function(t){s.videoUrl=t,i.$refs.vExample.reset()}))}},getInfo:function(){var t=this;this.appFetch({url:"forum",method:"get",data:{include:["users"]}}).then((function(e){if(e.errors)throw t.$toast.fail(e.errors[0].code),new Error(e.error);for(var i=e.readdata._data.set_attach.support_img_ext.split(","),a="",o="",s=0;s<i.length;s++)a="."+i[s]+",",o="image/"+i[s]+",",t.supportImgExt+=a,t.supportImgExtRes+=o;var n=e.readdata._data.set_attach.support_file_ext.split(","),r="";for(s=0;s<n.length;s++)r="."+n[s]+",",t.supportFileExt+=r;t.canUploadImages=e.readdata._data.other.can_upload_images,t.canUploadAttachments=e.readdata._data.other.can_upload_attachments}))},detailsLoad:function(){var t=this;this.appFetch({url:"threads",method:"get",splice:"/"+this.themeId,data:{include:["firstPost","firstPost.images","firstPost.attachments","category","threadVideo"]}}).then((function(e){if(e.errors)throw t.$toast.fail(e.errors[0].code),new Error(e.error);t.oldCateId=e.readdata.category._data.id,t.selectSort=e.readdata.category._data.name,t.content=e.readdata.firstPost._data.content,t.postsId=e.readdata.firstPost._data.id,t.vcVideoName=e.readdata.threadVideo._data.file_name,t.fileId=e.readdata.threadVideo._data.file_id,""!=t.vcVideoName&&null!=t.vcVideoName&&(t.videoShow=!0),e.readdata._data.price>0&&(t.payValue=e.readdata._data.price,t.paySetValue=e.readdata._data.price)}))},videoDeleClick:function(){this.videoShow=!1,this.videoUp=!0,this.fileId=""},publish:function(){var t=this;if(""==this.fileId||null==this.fileId)return this.$toast.fail("上传视频不能为空"),!1;this.oldCateId!=this.cateId&&this.appFetch({url:"threads",method:"patch",splice:"/"+this.themeId,data:{data:{type:"threads",attributes:{price:this.paySetValue,file_id:this.fileId,file_name:this.vcVideoName},relationships:{category:{data:{type:"categories",id:this.cateId}}}}}}).then((function(e){if(e.errors)throw t.$toast.fail(e.errors[0].code),new Error(e.error)})),this.appFetch({url:"posts",method:"patch",splice:"/"+this.postsId,data:{data:{type:"threads",attributes:{content:this.content},relationships:{attachments:{data:this.attriAttachment}}}}}).then((function(e){if(e.errors)throw t.$toast.fail(e.errors[0].code),new Error(e.error);t.$router.replace({path:"/details/"+t.themeId})}))},beforeHandleFile:function(){this.canUploadImages?this.limitMaxLength||this.$toast.fail("已达上传图片上限"):this.$toast.fail("没有上传图片的权限")},beforeHandleEnclosure:function(){this.canUploadAttachments?this.limitMaxEncLength||this.$toast.fail("已达上传附件上限"):this.$toast.fail("没有上传附件的权限")},clearKeywords:function(){this.keywords="",this.list=[];var t=this.$refs.textarea,e=40/d;t.style.height=e+"rem",e=60/d,t.focus()},handleFaceChoose:function(t){var e=this.content,i=this.$refs.textarea,a=i.selectionStart,o=i.selectionEnd,s=e.substring(0,a)+t+e.substring(o,e.length);this.content=s,i.setSelectionRange&&setTimeout((function(){var e=a+t.length;i.setSelectionRange(e,e)}),0)},addExpression:function(){var t=this;this.keyboard=!this.keyboard,this.appFetch({url:"emojis",method:"get",data:{include:""}}).then((function(e){t.faceData=e.readdata})),this.showFacePanel=!this.showFacePanel,this.showFacePanel?document.getElementById("postForm").style.height=this.viewportHeight-240+"px":document.getElementById("postForm").style.height="100%",this.footMove=!this.footMove,this.payMove=!this.payMove},backClick:function(){this.$router.go(-1)},dClick:function(){this.showPopup=!0},onConfirm:function(t,e){var i=t.id;this.cateId=i;t.text;this.showPopup=!1,this.selectSort=t.text},loadCategories:function(){var t=this;this.appFetch({url:"categories",method:"get",data:{include:""}}).then((function(e){if(e.errors)throw t.$toast.fail(e.errors[0].code),new Error(e.error);for(var i,a=0,o=(i=e.readdata).length;a<o;a++)t.categories.push({text:i[a]._data.name,id:i[a]._data.id}),t.categoriesId.push(i[a]._data.id)}))},onCancel:function(){this.showPopup=!1},paySetting:function(){this.paySetShow=!0,"免费"===this.payValue?this.paySetValue=null:this.paySetValue=this.payValue.slice(0,this.payValue.length-1),this.paySetShow&&setTimeout((function(){document.getElementById("payMoneyInp").focus()}),200)},closePaySet:function(){this.paySetShow=!1},search:function(t){"."!==this.paySetValue||(this.paySetValue="0.")},paySetSure:function(){this.paySetShow=!1,this.paySetValue<=0?this.payValue="免费":(this.paySetValue=Number(this.paySetValue),this.payValue=Number(this.paySetValue)+"元")}}}},uwTP:function(t,e,i){"use strict";i.r(e);var a=i("yaIx"),o=i.n(a);for(var s in a)"default"!==s&&function(t){i.d(e,t,(function(){return a[t]}))}(s);e.default=o.a},yaIx:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s(i("QbLZ")),o=s(i("6GI9"));function s(t){return t&&t.__esModule?t:{default:t}}e.default=(0,a.default)({name:"expressionView"},o.default)}}]);