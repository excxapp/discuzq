(window.webpackJsonp=window.webpackJsonp||[]).push([[54,116],{"+1ub":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.autoTextarea=function(t,e,i,a){e=e||0;var o=!!document.getBoxObjectFor||"mozInnerScreenX"in window,n=!!window.opera&&!!window.opera.toString().indexOf("Opera"),s=function(e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent("on"+e,i)},c=t.currentStyle?function(e){var i=t.currentStyle[e];if("height"===e&&1!==i.search(/px/i)){var a=t.getBoundingClientRect();return a.bottom-a.top-parseFloat(c("paddingTop"))-parseFloat(c("paddingBottom"))+"px"}return i}:function(e){return getComputedStyle(t,null)[e]},r=parseFloat(c("height"));t.style.resize="none";var l=function(){var s,l,d=0,h=t.style;t._length!==t.value.length&&(t._length=t.value.length,o||n||(d=parseInt(c("paddingTop"))+parseInt(c("paddingBottom"))),s=document.body.scrollTop||document.documentElement.scrollTop,t.style.height=r+"px",t.scrollHeight>r&&(i&&t.scrollHeight>i?(l=i-d,h.overflowY="hidden"):(l=t.scrollHeight-d,h.overflowY="hidden"),h.height=l+e+"px",s+=parseInt(h.height)-t.currHeight,document.body.scrollTop=s,document.documentElement.scrollTop=s,t.currHeight=parseInt(h.height),a(parseInt(h.height))))};s("propertychange",l),s("input",l),s("focus",l),l()},e.debounce=function(t,e){var i=void 0;return function(){for(var a=this,o=arguments.length,n=Array(o),s=0;s<o;s++)n[s]=arguments[s];i&&clearTimeout(i),i=setTimeout((function(){t.apply(a,n)}),e||500)}}},"6GI9":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={data:function(){return{active:0,faceIndex:0}},props:{faceData:{type:Array}},computed:{faces:function(){for(var t=this.faceData,e=(this.faceIndex,t),i=0,a=[];28*i<e.length;)a.push(e.slice(28*i,28*(i+1))),i+=1;return a},scrollWidth:function(){return this.faces.length*document.body.clientWidth},scrollPosition:function(){return this.active*document.body.clientWidth}},mounted:function(){var t=this,e=this.$refs.faceContent,i=0,a=0;e.ontouchstart=function(t){i=t.targetTouches[0].pageX},e.ontouchend=function(e){(a=e.changedTouches[0].pageX)-i>50?0!==t.active&&t.active--:a-i<-50&&t.active!==t.faces.length-1&&t.active++}},created:function(){},methods:{getUrlCode:function(){var t=this;this.code=this.$utils.getUrlKey("code"),alert(code),this.appFetch({url:"weixin",method:"get",data:{code:this.code}}).then((function(t){alert(65756765)}),(function(e){100004==e.errors[0].status&&t.$router.go(-1)}))},loginWxClick:function(){this.$router.push({path:"/wx-login-bd"})},loginPhoneClick:function(){this.$router.push({path:"/login-phone"})},onFaceClick:function(t){this.$emit("onFaceChoose",t)}}}},Aves:function(t,e,i){"use strict";i.d(e,"a",(function(){return a})),i.d(e,"b",(function(){return o}));var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"face-container"},[i("div",{staticClass:"scroll-wrapper"},[i("div",{ref:"faceContent",staticClass:"face-content",style:{width:t.scrollWidth+"px",marginLeft:-t.scrollPosition+"px"},on:{touchmove:function(t){t.preventDefault()}}},t._l(t.faces,(function(e,a){return i("div",{key:a,staticClass:"face-page"},t._l(e,(function(e,a){return i("a",{key:a},[i("img",{staticClass:"emoji",attrs:{src:e._data.url},on:{click:function(i){return t.onFaceClick(" "+e._data.code+" ")}}})])})),0)})),0),t._v(" "),i("div",{staticClass:"page-dot"},t._l(t.faces.length,(function(e){return i("div",{key:e,staticClass:"dot-item",class:e===t.active+1?"active":"",on:{click:function(i){t.active=e-1}}})})),0)])])},o=[]},SDcr:function(t,e,i){"use strict";i.r(e);var a=i("Aves"),o=i("uwTP");for(var n in o)"default"!==n&&function(t){i.d(e,t,(function(){return o[t]}))}(n);var s=i("KHd+"),c=Object(s.a)(o.default,a.a,a.b,!1,null,null,null);e.default=c.exports},YcMh:function(t,e,i){"use strict";i.r(e);var a=i("sNqi"),o=i("m49L");for(var n in o)"default"!==n&&function(t){i.d(e,t,(function(){return o[t]}))}(n);var s=i("KHd+"),c=Object(s.a)(o.default,a.a,a.b,!1,null,null,null);e.default=c.exports},eJQ4:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s(i("QbLZ")),o=s(i("rcAf")),n=s(i("SDcr"));function s(t){return t&&t.__esModule?t:{default:t}}i("iUmJ"),i("N960"),e.default=(0,a.default)({name:"post-video",components:{Expression:n.default}},o.default)},m49L:function(t,e,i){"use strict";i.r(e);var a=i("eJQ4"),o=i.n(a);for(var n in a)"default"!==n&&function(t){i.d(e,t,(function(){return a[t]}))}(n);e.default=o.a},rcAf:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("+1ub"),o=r(i("6NK7")),n=r(i("VVfg")),s=r(i("YSgG")),c=r(i("Bhkv"));function r(t){return t&&t.__esModule?t:{default:t}}var l=parseFloat(document.documentElement.style.fontSize);function d(){return(0,s.default)({url:"signature",method:"get"}).then((function(t){return t.readdata._data.signature}))}e.default={data:function(){return{headerTitle:"发布视频",selectSort:"",showPopup:!1,categories:[],categoriesId:[],cateId:"",content:"",showFacePanel:!1,keyboard:!1,keywordsMax:1e4,list:[],footMove:!1,payMove:!1,faceData:[],uploadShow:!1,avatar:"",themeId:"",postsId:"",files:{name:"",type:""},headerImage:null,picValue:null,upImgUrl:"",isWeixin:!1,isPhone:!1,themeCon:!1,attriAttachment:!1,canUploadImages:"",canUploadAttachments:"",supportVideoExt:"",supportVideoExtRes:"",fileSize:"",limitMaxLength:!0,limitMaxEncLength:!0,isiOS:!1,encuploadShow:!1,testingRes:!1,backGo:-2,formdataList:[],viewportWidth:"",viewportHeight:"",nowCate:[],payValue:"免费",paySetShow:!1,isCli:!0,moneyVal:"",paySetValue:"",videoShow:!1,videoUp:!0,vcVideoName:"",uploaderInfos:[],testingSizeRes:!1,testingTypeRes:!1,fileId:"",loading:!1,publishShow:"",appID:"",captcha:null,captcha_ticket:"",captcha_rand_str:""}},computed:{nowCateId:function(){return this.$route.params.cateId}},mounted:function(){var t=this;this.$nextTick((function(){var e=t.$refs.textarea;e.focus();var i=300;e&&(0,a.autoTextarea)(e,5,65535,(function(t){if((t+=20)!==i){i=t}}))})),1!=this.isWeixin&&1!=this.isPhone&&this.limitWidth()},created:function(){this.tcVod=new c.default({getSignature:d});var t=n.default.getLItem("siteInfo")._data.qcloud.qcloud_captcha,e=n.default.getLItem("siteInfo")._data.other.create_thread_with_captcha;this.appID=n.default.getLItem("siteInfo")._data.qcloud.qcloud_captcha_app_id,this.publishShow=!(t&&e);var i="";if(n.default.getLItem("siteInfo")&&n.default.getLItem("siteInfo")._data.qcloud.qcloud_vod_ext){this.fileSize=n.default.getLItem("siteInfo")._data.qcloud.qcloud_vod_size,i=n.default.getLItem("siteInfo")._data.qcloud.qcloud_vod_ext.split(",");for(var a="",s="",r=0;r<i.length;r++)a="."+i[r]+",",s="video/"+i[r]+",",this.supportVideoExt+=a,this.supportVideoExtRes+=s}else i="*";this.viewportWidth=window.innerWidth,this.viewportHeight=window.innerHeight,this.isWeixin=o.default.isWeixin().isWeixin,this.isPhone=o.default.isWeixin().isPhone;var l=navigator.userAgent;if(this.isAndroid=l.indexOf("Android")>-1||l.indexOf("Adr")>-1,this.isiOS=!!l.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),this.isiOS&&(this.encuploadShow=!0),this.$route.params.themeId){var h=this.$route.params.themeId,u=this.$route.params.postsId,p=this.$route.params.themeContent;this.themeId=h,this.postsId=u,this.content=p}this.loadCategories(),this.getInfo()},watch:{showFacePanel:function(t,e){this.showFacePanel=t,this.showFacePanel?document.getElementById("postForm").style.height=this.viewportHeight-240+"px":document.getElementById("postForm").style.height="100%"}},methods:{formatter:function(t){return this.handleReg(t)},handleReg:function(t){return 0==(t=t.toString()).indexOf(".")&&(t="0."),(t=(t=(t=(t=t.replace(/[^\d.]/g,"")).replace(/\.{2,}/g,".")).replace(".","$#$").replace(/\./g,"").replace("$#$",".")).replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3")).indexOf(".")<0&&""!=t&&(t=parseFloat(t)),t},vExampleAdd:function(){this.$refs.vExampleFile.click()},testingType:function(t,e){var i=t.name.substring(t.name.lastIndexOf(".")).toLowerCase();"-1"==e.indexOf(i+",")?(this.$toast.fail("文件格式不正确!"),this.testingTypeRes=!1):this.testingTypeRes=!0},testingSize:function(t,e){t.size/1024/1024>e?(this.$toast.fail("超出视频大小限制"),this.$refs.vExample.reset(),this.testingSizeRes=!1):this.testingSizeRes=!0},vExampleUpload:function(t){var e=this;if(this.testingType(t.target.files[0],this.supportVideoExt),this.testingSize(t.target.files[0],this.fileSize),this.testingSizeRes&&this.testingTypeRes){this.loading=!0;var i=this,a=this.$refs.vExampleFile.files[0];this.vcVideoName=this.$refs.vExampleFile.files[0].name;var o=this.tcVod.upload({mediaFile:a});o.on("media_progress",(function(t){n.progress=t.percent})),o.on("media_upload",(function(t){n.isVideoUploadSuccess=!0}));var n={videoInfo:o.videoInfo,isVideoUploadSuccess:!1,isVideoUploadCancel:!1,progress:0,fileId:"",videoUrl:"",cancel:function(){n.isVideoUploadCancel=!0,o.cancel()}};this.uploaderInfos.push(n),o.done().then((function(t){n.fileId=t.fileId,e.videoUp=!1,e.loading=!1,e.videoShow=!0,e.fileId=t.fileId})).then((function(t){n.videoUrl=t,i.$refs.vExample.reset()}))}},setVcExampleCoverName:function(){this.vcExampleCoverName=this.$refs.vcExampleCover.files[0].name},getInfo:function(){var t=this;this.appFetch({url:"forum",method:"get",data:{include:["users"]}}).then((function(e){if(e.errors)throw t.$toast.fail(e.errors[0].code),new Error(e.error);t.canUploadImages=e.readdata._data.other.can_upload_images,t.canUploadAttachments=e.readdata._data.other.can_upload_attachments}))},videoDeleClick:function(){this.videoShow=!1,this.videoUp=!0,this.fileId=""},publish:function(){var t=this;""!=this.content&&null!=this.content?0!=this.cateId&&null!=this.cateId?""!=this.vcVideoName?this.postsId&&this.content?this.appFetch({url:"posts",splice:"/"+this.postsId,method:"patch",data:{data:{type:"posts",attributes:{content:this.content}}}}).then((function(e){e.errors?e.errors[0].detail?t.$toast.fail(e.errors[0].code+"\n"+e.errors[0].detail[0]):t.$toast.fail(e.errors[0].code):t.$router.replace({path:"details/"+t.themeId,query:{backGo:t.backGo},replace:!0})})):this.appFetch({url:"threads",method:"post",data:{data:{type:"threads",attributes:{content:this.content,price:this.paySetValue,file_id:this.fileId,file_name:this.vcVideoName,type:2,captcha_ticket:this.captcha_ticket,captcha_rand_str:this.captcha_rand_str},relationships:{category:{data:{type:"categories",id:this.cateId}},attachments:{data:this.attriAttachment}}}}}).then((function(e){if(e.errors)e.errors[0].detail?t.$toast.fail(e.errors[0].code+"\n"+e.errors[0].detail[0]):t.$toast.fail(e.errors[0].code);else{var i=e.readdata._data.id;t.$router.replace({path:"/details/"+i,query:{backGo:t.backGo},replace:!0})}})):this.$toast.fail("视频不能为空"):this.$toast.fail("请选择分类"):this.$toast.fail("内容不能为空")},limitWidth:function(){document.getElementById("post-topic-footer").style.width="640px";var t=window.innerWidth;document.getElementById("post-topic-footer").style.left=(t-640)/2+"px"},getAllEvens:function(t){},clearKeywords:function(){this.keywords="",this.list=[];var t=this.$refs.textarea,e=40/l;t.style.height=e+"rem",e=60/l,t.focus()},searchChange:(0,a.debounce)((function(){if(this.keywords&&this.keywords.trim())this.keywords;else this.list=[]})),handleFaceChoose:function(t){var e=this.content,i=this.$refs.textarea,a=i.selectionStart,o=i.selectionEnd,n=e.substring(0,a)+t+e.substring(o,e.length);this.content=n,i.setSelectionRange&&setTimeout((function(){var e=a+t.length;i.setSelectionRange(e,e)}),0)},addExpression:function(){var t=this;this.keyboard=!this.keyboard,this.appFetch({url:"emojis",method:"get",data:{include:""}}).then((function(e){t.faceData=e.readdata})),this.showFacePanel=!this.showFacePanel,this.showFacePanel?document.getElementById("postForm").style.height=this.viewportHeight-240+"px":document.getElementById("postForm").style.height="100%",this.footMove=!this.footMove,this.payMove=!this.payMove},backClick:function(){this.$router.go(-1)},dClick:function(){this.showPopup=!0},onConfirm:function(t,e){var i=t.id;this.cateId=i;t.text;this.showPopup=!1,this.selectSort=t.text},loadCategories:function(){var t=this;this.appFetch({url:"categories",method:"get",data:{include:""}}).then((function(e){if(e.errors)throw t.$toast.fail(e.errors[0].code),new Error(e.error);for(var i=[],a=0,o=(i=e.readdata).length;a<o;a++)t.categories.push({text:i[a]._data.name,id:i[a]._data.id}),t.categoriesId.push(i[a]._data.id);if(0!=t.nowCateId&&null!=t.nowCateId){var n;n=i.find((function(e){if(e._data.id===t.nowCateId)return e})),t.nowCate={id:n._data.id,name:n._data.name},t.cateId=t.nowCate.id,t.selectSort=t.nowCate.name}else t.selectSort="选择分类"}))},onCancel:function(){this.showPopup=!1},paySetting:function(){this.paySetShow=!0,"免费"===this.payValue?this.paySetValue=null:this.paySetValue=this.payValue.slice(0,this.payValue.length-1),this.paySetShow&&setTimeout((function(){document.getElementById("payMoneyInp").focus()}),200)},closePaySet:function(){this.paySetShow=!1},search:function(t){"."!==this.paySetValue||(this.paySetValue="0.")},paySetSure:function(){this.paySetShow=!1,this.paySetValue<=0?this.payValue="免费":(this.paySetValue=Number(this.paySetValue),this.payValue=Number(this.paySetValue)+"元")},initCaptcha:function(){var t=this;""!=this.content&&null!=this.content?0!=this.cateId&&null!=this.cateId?""!=this.vcVideoName?(this.captcha=new TencentCaptcha(this.appID,(function(e){0===e.ret&&(t.captcha_ticket=e.ticket,t.captcha_rand_str=e.randstr,t.publish())})),this.captcha.show()):this.$toast.fail("视频不能为空"):this.$toast.fail("请选择分类"):this.$toast.fail("内容不能为空")}},beforeRouteLeave:function(t,e,i){this.captcha&&this.captcha.destroy(),i()}}},sNqi:function(t,e,i){"use strict";i.d(e,"a",(function(){return a})),i.d(e,"b",(function(){return o}));var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"post-topic-box"},[i("header",{staticClass:"post-topic-header",style:{overflow:"hidden",width:t.isPhone||t.isWeixin?"100%":"640px",left:t.isPhone||t.isWeixin?"0":(t.viewportWidth-640)/2+"px"}},[i("span",{staticClass:"icon iconfont icon-back post-topic-header-icon",on:{click:t.backClick}}),t._v(" "),i("h2",{staticClass:"postHeadTit"},[t._v(t._s(t.headerTitle))]),t._v(" "),t.publishShow?i("van-button",{attrs:{type:"primary",size:"mini"},on:{click:t.publish}},[t._v("发布")]):i("van-button",{attrs:{type:"primary",size:"mini",id:"TencentCaptcha","data-appid":"appID"},on:{click:t.initCaptcha}},[t._v("发布")])],1),t._v(" "),i("div",{staticClass:"post-topic-form",attrs:{id:"postForm"}},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],ref:"textarea",staticClass:"reply-box",attrs:{id:"post-topic-form-text",name:"post-topic",placeholder:"请输入内容",maxlength:t.keywordsMax},domProps:{value:t.content},on:{change:t.searchChange,focus:function(e){t.showFacePanel=!1,t.footMove=!1,t.keyboard=!1},input:function(e){e.target.composing||(t.content=e.target.value)}}}),t._v(" "),i("form",{ref:"vExample"},[i("input",{ref:"vExampleFile",staticStyle:{display:"none"},attrs:{type:"file",accept:t.supportVideoExtRes,multiple:""},on:{change:t.vExampleUpload}})]),t._v(" "),t.videoUp?i("div",{staticClass:"vedioUpBox"},[i("div",{staticClass:"videoUploader",on:{click:t.vExampleAdd}},[i("span",{staticClass:"icon iconfont icon-add"})])]):t._e(),t._v(" "),t.videoShow?i("div",{staticClass:"videoCon"},[i("div",{staticClass:"videoChi"},[i("span",{staticClass:"icon iconfont icon-video1"}),t._v(" "),i("span",{staticClass:"videoName"},[t._v(t._s(t.vcVideoName))]),t._v(" "),i("van-icon",{staticClass:"videoDelete",attrs:{name:"clear"},on:{click:function(e){return t.videoDeleClick()}}})],1)]):t._e()]),t._v(" "),i("van-cell",{staticClass:"paySetting borderT",class:{payMove:t.payMove},style:{overflow:"hidden",width:t.isPhone||t.isWeixin?"100%":"640px",left:t.isPhone||t.isWeixin?"0":(t.viewportWidth-640)/2+"px"},attrs:{title:"付费设置","is-link":"",value:t.payValue},on:{click:t.paySetting}}),t._v(" "),i("footer",{staticClass:"post-topic-footer",class:{footMove:t.footMove},attrs:{id:"post-topic-footer"}},[i("div",{staticClass:"post-topic-footer-left",class:{width20:t.encuploadShow}},[i("span",{staticClass:"icon iconfont icon-label post-topic-header-icon",class:{"icon-keyboard":t.keyboard},on:{click:t.addExpression}})]),t._v(" "),i("div",{staticClass:"post-topic-footer-right",on:{click:t.dClick}},[i("span",{staticClass:"post-topic-footer-right-sort"},[t._v(t._s(t.selectSort))]),t._v(" "),i("span",{staticClass:"icon iconfont icon-down-menu post-topic-header-icon",staticStyle:{color:"#888888"}})])]),t._v(" "),i("van-popup",{staticClass:"paySetShow",attrs:{"click-overlay":"closePaySet"},model:{value:t.paySetShow,callback:function(e){t.paySetShow=e},expression:"paySetShow"}},[i("div",{staticClass:"popTitBox"},[i("span",{staticClass:"popupTit"},[t._v("设置金额")]),t._v(" "),i("span",{staticClass:"icon iconfont icon-closeCho",on:{click:t.closePaySet}})]),t._v(" "),i("div",{staticClass:"payMoneyBox"},[i("van-field",{attrs:{type:"number",maxlength:"10",clearable:"",label:"￥",formatter:t.formatter},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search(e)},input:function(e){return t.search(e)}},model:{value:t.paySetValue,callback:function(e){t.paySetValue=e},expression:"paySetValue"}})],1),t._v(" "),i("a",{staticClass:"popSureBtn",class:{sureBtnCli:t.isCli,forbiddenCli:!t.isCli},attrs:{href:"javascript:;"},on:{click:function(e){t.isCli&&t.paySetSure()}}},[t._v("确定")])]),t._v(" "),t.showFacePanel?i("Expression",{staticClass:"expressionBox",style:{overflow:"hidden",width:t.isPhone||t.isWeixin?"100%":"640px",left:t.isPhone||t.isWeixin?"0":(t.viewportWidth-640)/2+"px"},attrs:{faceData:t.faceData,id:"showFacePanel"},on:{onFaceChoose:t.handleFaceChoose}}):t._e(),t._v(" "),i("div",{staticClass:"popup"},[i("van-popup",{style:{height:"50%"},attrs:{position:"bottom",round:""},model:{value:t.showPopup,callback:function(e){t.showPopup=e},expression:"showPopup"}},[i("van-picker",{attrs:{columns:t.categories,"show-toolbar":"",title:"选择分类"},on:{cancel:t.onCancel,confirm:t.onConfirm}})],1)],1),t._v(" "),t.loading?i("div",{staticClass:"loadFix"},[i("div",{staticClass:"loadMask"}),t._v(" "),i("van-loading",{staticClass:"loadIcon",attrs:{color:"#333333",type:"spinner"}})],1):t._e()],1)},o=[]},uwTP:function(t,e,i){"use strict";i.r(e);var a=i("yaIx"),o=i.n(a);for(var n in a)"default"!==n&&function(t){i.d(e,t,(function(){return a[t]}))}(n);e.default=o.a},yaIx:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n(i("QbLZ")),o=n(i("6GI9"));function n(t){return t&&t.__esModule?t:{default:t}}e.default=(0,a.default)({name:"expressionView"},o.default)}}]);